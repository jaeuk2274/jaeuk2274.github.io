---  
title: "스프링 웹 MVC-19.폼 서브밋(에러 처리), @SessionAttributes(핸들러 메소드)"
date: 2020-01-01
categories: 
- Back-end
tags:
- Spring 
- Spring MVC
comments : true
---

## 핸들러 메소드 7부: 폼 서브밋 (에러 처리)

바인딩 에러 발생 시 Model에 담기는 정보
- Event
- BindingResult.event

타임리프 사용시 바인딩 에러 보여주기
- https://www.thymeleaf.org/doc/tutorials/2.1/thymeleafspring.html#field-errors
~~~html
<p th:if="${#fields.hasErrors('limit')}" th:errors="*{limit}">Incorrect date</p>
~~~

Post / Redirect / Get 패턴
- https://en.wikipedia.org/wiki/Post/Redirect/Get
- Post 이후에 브라우저를 리프래시 하더라도 폼 서브밋이 발생하지 않도록 하는 패턴

타임리프 목록 보여주기
- https://www.thymeleaf.org/doc/tutorials/2.1/thymeleafspring.html#listing-seed-starter-data


### 실습
~~~html
<form action="#" th:action="@{/events}" method="post" th:object="${event}">
    <p th:if="${#fields.hasErrors('age')}" th:errors="*{age}">에러 있으면 벨리데이트 에러메세지 출력</p>
    <p th:if="${#fields.hasErrors('name')}" th:errors="*{name}">에러 있으면 벨리데이트 에러메세지 출력</p>
    <input type="text" title="name" th:field="*{name}"/>
    <input type="text" title="age" th:field="*{age}"/>
    <input type="submit" value="create">
</form>
~~~

~~~java
    @PostMapping(value = "/events")
    public String createEvent(@Validated @ModelAttribute Event event,
                         BindingResult bindingResult,
                         Model model) {
        if(bindingResult.hasErrors()){
            return "/events/form";
        }

        List<Event> eventList = new ArrayList<>();
        eventList.add(event);
        model.addAttribute(eventList);

        // return "/events/list";
        // post 후 새로고침을 하게 되면, 브라우저가 기존 작업을 다시 하는 지 체크(입력 정보를 다시 post 하겠냐? 체크)
        // 해결방안으로 post 한 다음 get 리다이렉트를 해 준다.
        return "redirect:/events/list"; // 중복 submit 발생하지 않음
    }

    @GetMapping("/events/list")
    public String getEvents(Model model){
        // db의 리스트를 꺼내온다고 가정.
        Event event = new Event();
        event.setName("jaeuk");
        event.setAge(30);

        List<Event> eventList = new ArrayList<>();
        eventList.add(event);

        model.addAttribute(eventList);

        return "/events/list";
    }
~~~

~~~html
<a th:href="@{/events/form}">Create New Event</a>
<div th:unless="${#lists.isEmpty(eventList)}">
    <ul th:each="event: ${eventList}">
        <p th:text="${event.Name}">Event Name</p>
    </ul>
</div>
~~~



## 핸들러 메소드 8부: @SessionAttributes

모델 정보를 HTTP 세션에 저장해주는 애노테이션
- HttpSession을 직접 사용할 수도 있지만
- 이 애노테이션에 설정한 이름에 해당하는 모델 정보를 자동으로 세션에 넣어준다.
- @ModelAttribute는 세션에 있는 데이터도 바인딩한다.
- 여러 화면(또는 요청)에서 사용해야 하는 객체를 공유할 때 사용한다.

SessionStatus를 사용해서 세션 처리 완료를 알려줄 수 있다.
- 폼 처리 끝나고 세션을 비울 때 사용한다.



