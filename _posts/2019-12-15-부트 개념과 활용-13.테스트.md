---
title: "부트 개념과 활용-13.테스트"
date: 2019-12-15
categories:
- Back-end
tags:
- Spring 
- Boot
- Test
comments : true
---

이 문서는 추후 정리 예정인 문서입니다.

## 테스트

시작은 일단 spring-boot-starter-test를 추가하는 것 부터
● test 스콥으로 추가.
@SpringBootTest
● @RunWith(SpringRunner.class)랑 같이 써야 함.
● 빈 설정 파일은 설정을 안해주나? 알아서 찾습니다. (@SpringBootApplication)
● webEnvironment
○ MOCK: mock servlet environment. 내장 톰캣 구동 안 함.
○ RANDON_PORT, DEFINED_PORT: 내장 톰캣 사용 함.
○ NONE: 서블릿 환경 제공 안 함.
@MockBean
● ApplicationContext에 들어있는 빈을 Mock으로 만든 객체로 교체 함.
● 모든 @Test 마다 자동으로 리셋.
슬라이스 테스트
● 레이어 별로 잘라서 테스트하고 싶을 때
● @JsonTest
● @WebMvcTest
● @WebFluxTest
● @DataJpaTest

예제 코드
~~~java
@RestController
public class SampleController {

    @Autowired
    private SampleService sampleService;

    @GetMapping("hello")
    public String hello(){
        return "hello " + sampleService.getName();
    }
}
~~~

~~~java
@Service
public class SampleService {
    public String getName() {
        return "jaeuk";
    }
}
~~~

~~~java
@ExtendWith(SpringExtension.class) // junit 5 기준
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.MOCK)
// 서블릿 컨테이너를 테스트용으로 띄우지 않고, 서블릿을 모킹한게 뜬다.
// 디스패처서블릿이 뜨긴 하는데, 디스패처 서블릿으로 요청을 보내는것과 비슷하게 실행은 할 수 있는데, 목업이 된 서블릿이 인터렉션 하려면 MockMvc 클라이언트를 사용해야 한다.
@AutoConfigureMockMvc // MockMvc를 만드는 가장 쉬온 방법
class SampleControllerTest {
    @Autowired
    MockMvc mockMvc;

    @Test
    public void hello() throws Exception{
        mockMvc.perform(get("/hello"))
                .andExpect(status().isOk())
                .andExpect(content().string("hello jaeuk"))
                .andDo(print());
    }
}
~~~



랜덤포트 사용할때 서블릿 컨테이너가(내장 톰켓이) 뜬다.     
이땐 목엠브이씨 가 이 아니라 테스트 레스트 템플릿 이나 테스트용 웹 클라이언트를 써야 한다.
~~~java
@ExtendWith(SpringExtension.class) // junit 5 기준
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT) // 랜덤포트 사용할때 서블릿 컨테이너가(내장 톰켓이) 뜬다.
// 이땐 목엠브이씨 가 이 아니라 테스트 레스트 템플릿 이나 테스트용 웹 클라이언트를 써야 한다.
class SampleControllerTest {
    @Autowired
    TestRestTemplate testRestTemplate; // 이상태에선 주입 가능

    // 근데 이 컨트롤러가 서비스까지 연결되어 있다.(테스트 커짐)
    @MockBean
    SampleService mocSampleService; // 목빈으로 설정하면 sampleService 를 mockSampleService 만들어서 쓰는 것

    @Test
    public void hello() throws Exception{
        when(mocSampleService.getName()).thenReturn("jaeuk"); // getNaem 이 호출되면 jaeuk 리턴받는다
        // SampleService 얘를 모킹해서 @MockBean 을 사용해 그 빈을 교체한 것.

        String result = testRestTemplate.getForObject("/hello", String.class);
        assertEquals(result, "hello jaeuk");
    }
}
~~~
