---
title: "부트 개념과 활용-04.내장 웹 서버 이해"
date: 2019-12-14
categories:
- Back-end
tags:
- Spring 
- Boot
comments : true
---

이 문서는 추후 정리 예정인 문서입니다.

● 스프링 부트는 서버가 아니다.
○ 톰캣 객체 생성
○ 포트 설정
○ 톰캣에 컨텍스트 추가
○ 서블릿 만들기
○ 톰캣에 서블릿 추가
○ 컨텍스트에 서블릿 맵핑
○ 톰캣 실행 및 대기
● 이 모든 과정을 보다 상세히 또 유연하고 설정하고 실행해주는게 바로 스프링 부트의
자동 설정.
○ ServletWebServerFactoryAutoConfiguration (서블릿 웹 서버 생성)
■ TomcatServletWebServerFactoryCustomizer (서버 커스터마이징)
○ DispatcherServletAutoConfiguration
■ 서블릿 만들고 등록




 public class Application {

    public static void main(String[] args) throws LifecycleException {
        Tomcat tomcat = new Tomcat();
        tomcat.setPort(8080);

        Context context = tomcat.addContext("/", "/");

        HttpServlet servlet = new HttpServlet() {
            @Override
            protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
                PrintWriter writer = resp.getWriter();
                writer.println("<html><head><title>");
                writer.println("hey, jaeuk tomcat");
                writer.println("</title></head>");
                writer.println("<body><h1>hi jaeuk!</h1></body");
                writer.println("</html>");
                writer.println("<html><head><title>");
            }
        };

        String serveletName = "helloServelet";
        tomcat.addServlet("/", serveletName, servlet);
        context.addServletMapping("/hello", serveletName);
        // /hello 요청이 오면 serveletName(helloServelet) 위에서 생성한 서블릿을 보여주는 것

        tomcat.start();
        tomcat.getServer().await();
    }
}



실행 결과

[!실행 결과](https://github.com/jaeuk2274/jaeuk2274.github.io/blob/master/_posts/img/%EC%8A%A4%ED%94%84%EB%A7%81%20%EB%B6%80%ED%8A%B8%20%EA%B0%9C%EB%85%90%EA%B3%BC%20%ED%99%9C%EC%9A%A9/01.real%20tomcat.png?raw=true)


사실 이런 것들이 다 자동 설정이 되는 것이다.     


이전 포스트인 자동설정과 관련이 있다.

스프링 부트 어플리케이션을 실행하면 톰캣이 만들어지고 서블릿이 추가되고 웹 엠브이씨  설정이 되고 띄워지는 것



이전 포스트에서 살펴본


캡처
spring-boot-autoconfigration - META-INF - spring.factories 안을 보면
~~~xml
...
# Auto Configure
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\

...
org.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration,\
...
~~~
이 존재한다. 

ServletWebServerFactoryAutoConfiguration 이 안을 보면

~~~java
@Configuration
@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)
@ConditionalOnClass(ServletRequest.class)
@ConditionalOnWebApplication(type = Type.SERVLET)
@EnableConfigurationProperties(ServerProperties.class)
@Import({ ServletWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrar.class,
		ServletWebServerFactoryConfiguration.EmbeddedTomcat.class,
		ServletWebServerFactoryConfiguration.EmbeddedJetty.class,
		ServletWebServerFactoryConfiguration.EmbeddedUndertow.class })
public class ServletWebServerFactoryAutoConfiguration {

	@Bean
	public ServletWebServerFactoryCustomizer servletWebServerFactoryCustomizer(
			ServerProperties serverProperties) {
		return new ServletWebServerFactoryCustomizer(serverProperties);
	}

	@Bean
	@ConditionalOnClass(name = "org.apache.catalina.startup.Tomcat")
	public TomcatServletWebServerFactoryCustomizer tomcatServletWebServerFactoryCustomizer(
			ServerProperties serverProperties) {
		return new TomcatServletWebServerFactoryCustomizer(serverProperties);
	}
...
~~~    

	ServletWebServerFactoryConfiguration.EmbeddedTomcat.class
 
EmbeddedTomcat 들어가머ㅕㄴ
~~~java
	@Configuration
	@ConditionalOnClass({ Servlet.class, Tomcat.class, UpgradeProtocol.class })
	@ConditionalOnMissingBean(value = ServletWebServerFactory.class, search = SearchStrategy.CURRENT)
	public static class EmbeddedTomcat {

		@Bean
		public TomcatServletWebServerFactory tomcatServletWebServerFactory() {
			return new TomcatServletWebServerFactory();
		}
	}
~~~
  
안의
  
TomcatServletWebServerFactory 보면
  
커넥터, 컨텍스트 설정,  클래스 로더 등등.. 설정들을 다 해준다.

서버를 커스터마이징(TomcatServletWebServerFactoryCustomizer) 할 수도 있다.


○ ServletWebServerFactoryAutoConfiguration (서블릿 웹 서버 생성)
■ TomcatServletWebServerFactoryCustomizer (서버 커스터마이징)
○ DispatcherServletAutoConfiguration
■ 서블릿 만들고 등록


마찬ㄹ가지로 서블릿도

DispatcherServletAutoConfiguration




