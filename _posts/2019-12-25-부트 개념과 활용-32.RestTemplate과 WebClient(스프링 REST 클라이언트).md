---
title: "부트 개념과 활용-32.RestTemplate과 WebClient(스프링 REST 클라이언트)"
date: 2019-12-25
categories:
- Back-end
tags:
- Spring 
- Boot
- REST
comments : true
---

## 스프링 REST 클라이언트 1부: RestTemplate과 WebClient
### RestTemplate
Blocking I/O 기반의 Synchronous API
RestTemplateAutoConfiguration
프로젝트에 spring-web 모듈이 있다면 RestTemplateBuilder를 빈으로 등록해 줍니다.
https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#rest-client-access
 
#### 구현 코드(RestTemplate)
~~~java
@RestController
public class SampleController {

    @GetMapping("/hello")
    public String hello() throws InterruptedException {
        Thread.sleep(5000l);
        return "hello";
    }

    @GetMapping("/world")
    public String world() throws InterruptedException {
        Thread.sleep(3000l);
        return "world";
    }
}
 ~~~
 
~~~java
@Component
public class RestRunner implements ApplicationRunner {

    @Autowired
    RestTemplateBuilder restTemplateBuilder;

    @Override
    public void run(ApplicationArguments args) throws Exception {
        RestTemplate restTemplate = restTemplateBuilder.build();

        StopWatch stopWatch = new StopWatch();
        stopWatch.start();

        // TODO /hello
        String helloResult = restTemplate.getForObject("http://localhost:8080/hello", String.class);
        System.out.println(helloResult);

        // TODO /world
        String worldResult = restTemplate.getForObject("http://localhost:8080/world", String.class);
        System.out.println(worldResult);

        stopWatch.stop();
        System.out.println(stopWatch.prettyPrint());
    }
}
~~~

실행결과
~~~
hello
world
StopWatch '': running time = 8135775176 ns
---------------------------------------------
ns         %     Task name
---------------------------------------------
8135775176  100%  

~~~



### WebClient
Non-Blocking I/O 기반의 Asynchronous API
WebClientAutoConfiguration
프로젝트에 spring-webflux 모듈이 있다면 WebClient.Builder를 빈으로 등록해 줍니다.
https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html#webflux-client


#### 실습 코드(WebClient)

의존성 추가
~~~xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-webflux</artifactId>
</dependency>
~~~

~~~java
@Component
public class RestRunner implements ApplicationRunner {

    @Autowired
    WebClient.Builder builder;

    @Override
    public void run(ApplicationArguments args) throws Exception {
        WebClient webClient = builder.build();

        StopWatch stopWatch = new StopWatch();
        stopWatch.start();

        // TODO /hello
        Mono<String> helloMono = webClient.get().uri("http://localhost:8080/hello")
                .retrieve()
                .bodyToMono(String.class);
        // 이 상태까지는 진행되지 않음.(Non-Blocking)

        // subscribe 해야 진행 (Asynchronous 처리
        helloMono.subscribe(s -> {
            System.out.println(s);

            if(stopWatch.isRunning()) {
                stopWatch.stop();
            }
            System.out.println(stopWatch.prettyPrint());
            stopWatch.start();
        });

       // TODO /world
        Mono<String> worldMono = webClient.get().uri("http://localhost:8080/world")
                .retrieve()
                .bodyToMono(String.class);

        worldMono.subscribe(s -> {
            System.out.println(s);

            if(stopWatch.isRunning()) {
                stopWatch.stop();
            }
            System.out.println(stopWatch.prettyPrint());
            stopWatch.start();
        });

        stopWatch.stop();
        System.out.println(stopWatch.prettyPrint());
    }
}
~~~

실행결과
~~~
StopWatch '': running time = 209767723 ns
---------------------------------------------
ns         %     Task name
---------------------------------------------
209767723  100%  

2019-12-25 19:43:44.481  INFO 34054 --- [nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2019-12-25 19:43:44.482  INFO 34054 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2019-12-25 19:43:44.487  INFO 34054 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 5 ms
world
StopWatch '': running time = 209767723 ns
---------------------------------------------
ns         %     Task name
---------------------------------------------
209767723  100%  

hello
StopWatch '': running time = 2165328090 ns
---------------------------------------------
ns         %     Task name
---------------------------------------------
209767723  010%  
1955560367  090%  
~~~




world
StopWatch '': running time = 209767723 ns

약 3초(2097) 후 world가 먼저 찍힌 것을 볼 수 있고,

hello
StopWatch '': running time = 2165328090 ns

약 2초(2145)후 hello가 찍힌 것을 볼 수 있다.
