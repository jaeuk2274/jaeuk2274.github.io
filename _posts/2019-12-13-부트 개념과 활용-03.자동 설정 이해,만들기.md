---
title: "부트 개념과 활용-03.자동 설정 이해/만들기"
date: 2019-12-13
categories:
- Back-end
tags:
- Spring 
- Boot
comments : true
---

이 문서는 추후 정리 예정인 문서입니다.

## 자동 설정 이해
@EnableAutoConfiguration
- @SpringBootApplication 안에 @EnableAutoConfiguration 들어있다.

- 빈은 사실 두 단계로 나눠서 읽힘 
  - 1단계: @ComponentScan  
  - 2단계: @EnableAutoConfiguration
  
- @ComponentScan
  - @Component
  - @Configuration @Repository @Service @Controller @RestController
  
- @EnableAutoConfiguration
  - spring.factories
  
- org.springframework.boot.autoconfigure.EnableAutoConfiguration
  - @Configuration
  - @ConditionalOnXxxYyyZzz


~~~java
//@SpringBootConfiguration
//@ComponentScan // (1) 컴포넌트 스캔으로 등록한 다음
//@EnableAutoConfiguration // (2) 추가적인 빈들을 읽어서 빈들을 등록

@Configuration // 나 자신도 빈이 된다.
@ComponentScan // @EnableAutoConfiguration 없어도 실행 잘됨
public class Application {

    public static void main(String[] args){
        // 웹서버 안띄우고 실행
        SpringApplication application = new SpringApplication(Application.class);
        application.setWebApplicationType(WebApplicationType.NONE);
        application.run(args);

        //SpringApplication.run(Application.class, args);
    }
}
~~~

EnableAutoConfiguration
  - spring.factories
안에는 이런 식으로

~~~xml
# Initializers
org.springframework.context.ApplicationContextInitializer=\
org.springframework.boot.autoconfigure.SharedMetadataReaderFactoryContextInitializer,\
org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener

# Application Listeners
org.springframework.context.ApplicationListener=\
org.springframework.boot.autoconfigure.BackgroundPreinitializer

# Auto Configuration Import Listeners
org.springframework.boot.autoconfigure.AutoConfigurationImportListener=\
org.springframework.boot.autoconfigure.condition.ConditionEvaluationReportAutoConfigurationImportListener

# Auto Configuration Import Filters
org.springframework.boot.autoconfigure.AutoConfigurationImportFilter=\
org.springframework.boot.autoconfigure.condition.OnClassCondition

# Auto Configure
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\
org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\
org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\
org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\
org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\
org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguratio
...
~~~

key=value, value2... 타입으로        
자동 설정되어서 생성될 빈들이 미리 정의가 되어 있다.       

이걸 EnableAutoConfiguration


## 자동 설정 만들기 1부 : Starter와 AutoConfigure 


신규 프로젝트 pom.xml
~~~xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>me.jaeuk</groupId>
    <artifactId>jaeuk-spring-boot-starter</artifactId>
    <version>1.0-SNAPSHOT</version>

    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-autoconfigure</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-autoconfigure-processor</artifactId>
            <optional>true</optional>
        </dependency>
    </dependencies>
    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-dependencies</artifactId>
                <version>2.0.3.RELEASE</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>
</project>
~~~

~~~java
public class Holeman {

    String name;
    int howLong;

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getHowLong() {
        return howLong;
    }

    public void setHowLong(int howLong) {
        this.howLong = howLong;
    }

    @Override
    public String toString() {
        return "Holeman{" +
                "name='" + name + '\'' +
                ", howLong=" + howLong +
                '}';
    }
}
~~~

~~~java
// 홀로맨 빈을 리턴하는 설정파일
@Configuration
public class HolemanConfiguration {

    @Bean
    public Holeman holeman(){
        Holeman holeman = new Holeman();
        holeman.setHowLong(5);
        holeman.setName("jaeuk");
        return holeman;
    }
}
~~~

resuouces 에 META-INF 디렉토리 생성
spring.facotries 파일 생성 (이건 부트에 특화된게 아니라 스프링에서 있는 것, 스프링의 라이프사이클에 활용되거나)

~~~xml
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
  me.jaeuk.HolemanConfiguration

<!-- EnableAutoConfiguration 켜져있으면, 키에 해당하는 값들을 쭉 읽게 될 것이고, 해당 빈 설정을 보고 쓴다. -->
~~~



maven install 로 jar 파일을 생성하고

본래 프로젝트로 돌아가서
pom.xml 에 의존성 추가
        <dependency>
            <groupId>me.jaeuk</groupId>
                <artifactId>jaeuk-spring-boot-starter</artifactId>
            <version>1.0-SNAPSHOT</version>
        </dependency>

확인할 수 있다.

[캡처]


@Component
public class HolomanRunner implements ApplicationRunner {

    @Autowired
    Holeman holeman;

    @Override
    public void run(ApplicationArguments args) throws Exception{
        System.out.println(holeman);
    }

}


실행하면
~~~xml
Holeman{name='jaeuk', howLong=5}
~~~

출력되는 것을 확인할 수 있다.

그렇다면

@SpringBootApplication
public class Application {

    public static void main(String[] args){
        // 웹서버 안띄우고 실행
        SpringApplication application = new SpringApplication(Application.class);
        application.setWebApplicationType(WebApplicationType.NONE);
        application.run(args);

        //SpringApplication.run(Application.class, args);
    }

    // (1) 먼저 컴포넌트 스캔으로 빈 생성 -> (2) 추후 기타 빈 생성 (즉, 이건 덮어인다)
    @Bean
    public Holeman holeman() {
        Holeman holeman = new Holeman();
        holeman.setName("suhun");
        holeman.setHowLong(30);
        return holeman;
    }
}

이 경우에는 어떻게 출력이 될까?

~~~xml
Holeman{name='jaeuk', howLong=5}
~~~
로 동일하다. 왜냐햐면 앞서 말했듯, 
1. 컴포넌트 스캔으로 빈을 등록 한 다음
2. 오토컨피규레이션으로 빈을 등록한다.


## 자동 설정 만들기 2부 : @ConfigurationProperties


